---
- hosts: dockerhost
  become: no
  tasks:
    - name: Remove container if any
      docker_container:
        state: absent
        name: sowtracker

    - name: Remove Image if any
      docker_image:
        state: absent
        name: 34.204.84.152:8085/sowtracker:1.3

    - name: Log into private registry and force re-authorization
      docker_login:
        registry: 'http://34.204.84.152:8085'
        username: "admin"
        password: "nexusadmin"

    - name: Ensure a container is running
      docker_container:
        name: sowtracker
        state: started
        image: 34.204.84.152:8085/sowtracker:1.3
        pull: true
        ports:
          - "8080:80"
